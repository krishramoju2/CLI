<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Web CLI Terminal</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      background: #000;
      color: #0f0;
      font-family: monospace;
      margin: 0;
      padding: 1rem;
      overflow-x: hidden;
    }
    #terminal {
      white-space: pre-wrap;
      min-height: 90vh;
    }
    #cliInput {
      width: 100%;
      background: #000;
      color: #0f0;
      border: none;
      font-family: monospace;
      font-size: 1rem;
      outline: none;
    }
  </style>
</head>
<body>
  <div id="terminal"></div>
  <input type="text" id="cliInput" autocomplete="off" spellcheck="false" />

  <script>
    const { body } = document;
    const terminal = document.getElementById("terminal");
    const cliInput = document.getElementById("cliInput");

    class File {
      constructor(name, content = "") {
        this.name = name;
        this.content = content;
        this.type = "file";
      }
    }

    class Directory {
      constructor(name) {
        this.name = name;
        this.type = "dir";
        this.children = {};
      }
    }

    const fs = new Directory("/");
    let cwd = fs;
    let pathStack = ["/"];

    function getPath() {
      return "/" + pathStack.slice(1).join("/");
    }

    function prompt() {
      terminal.innerHTML += `\n${getPath()} $ `;
      cliInput.value = "";
      cliInput.focus();
      scrollToBottom();
    }

    function print(text) {
      terminal.innerHTML += text + "\n";
    }

    function updateTerminal(command) {
      terminal.innerHTML += `${command}\n`;
    }

    function listDir(dir) {
      return Object.keys(dir.children).join("  ");
    }

    function runCommand(input) {
      const [cmd, ...args] = input.trim().split(/\s+/);
      switch (cmd) {
        case "mkdir":
          if (!args[0]) return print("Usage: mkdir <dirname>");
          if (cwd.children[args[0]]) return print("Directory already exists");
          const newDir = new Directory(args[0]);
          newDir.parent = cwd;
          cwd.children[args[0]] = newDir;
          break;

        case "touch":
          if (!args[0]) return print("Usage: touch <filename>");
          cwd.children[args[0]] = new File(args[0]);
          break;

        case "ls":
          print(listDir(cwd));
          break;

        case "cd":
          if (!args[0]) return print("Usage: cd <dirname>");
          if (args[0] === "/") {
            cwd = fs;
            pathStack = ["/"];
          } else if (args[0] === "..") {
            if (cwd.parent) {
              cwd = cwd.parent;
              pathStack.pop();
            }
          } else {
            const target = cwd.children[args[0]];
            if (!target || target.type !== "dir") return print("No such directory");
            cwd = target;
            pathStack.push(args[0]);
          }
          break;

        case "rmdir":
          if (!args[0]) return print("Usage: rmdir <dirname>");
          const dirToRemove = cwd.children[args[0]];
          if (!dirToRemove || dirToRemove.type !== "dir") return print("No such directory");
          if (Object.keys(dirToRemove.children).length > 0) return print("Directory not empty");
          delete cwd.children[args[0]];
          break;

        case "rm":
          if (!args[0]) return print("Usage: rm <filename>");
          const fileToRemove = cwd.children[args[0]];
          if (!fileToRemove || fileToRemove.type !== "file") return print("No such file");
          delete cwd.children[args[0]];
          break;

        case "mv":
          if (args.length < 2) return print("Usage: mv <source> <target>");
          if (!cwd.children[args[0]]) return print("No such file or directory");
          cwd.children[args[1]] = cwd.children[args[0]];
          cwd.children[args[1]].name = args[1];
          delete cwd.children[args[0]];
          break;

        case "cp":
          if (args.length < 2) return print("Usage: cp <source> <target>");
          const source = cwd.children[args[0]];
          if (!source) return print("No such file or directory");
          if (source.type === "file") {
            cwd.children[args[1]] = new File(args[1], source.content);
          } else {
            const cloneDir = JSON.parse(JSON.stringify(source));
            cwd.children[args[1]] = buildDirFromJSON(cloneDir);
            cwd.children[args[1]].name = args[1];
            cwd.children[args[1]].parent = cwd;
          }
          break;

        case "curl":
          if (!args[0]) return print("Usage: curl <url>");
          print(`Fetching from ${args[0]}...\n{\n  "data": "This is dummy JSON from ${args[0]}"\n}`);
          break;

        case "":
          break;

        default:
          print("Command not recognized");
      }
    }

    function buildDirFromJSON(json) {
      if (json.type === "file") {
        return new File(json.name, json.content);
      } else {
        const dir = new Directory(json.name);
        for (const key in json.children) {
          dir.children[key] = buildDirFromJSON(json.children[key]);
          dir.children[key].parent = dir;
        }
        return dir;
      }
    }

    function scrollToBottom() {
      window.scrollTo(0, document.body.scrollHeight);
    }

    cliInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        const input = cliInput.value;
        updateTerminal(`${getPath()} $ ${input}`);
        runCommand(input);
        prompt();
      }
    });

    window.addEventListener("click", () => cliInput.focus());

    prompt();
  </script>
</body>
</html>
